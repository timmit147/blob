<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Blob → Shape</title><style>:root{--bg:#0b0f19;--fg:#e9eefc;--muted:rgba(233,238,252,.68);--ui:rgba(255,255,255,.08);--ui-b:rgba(255,255,255,.14)}html,body{height:100%;margin:0}body{background:radial-gradient(1200px 700px at 50% 40%,#151d33 0%,var(--bg) 60%,#070a12 100%);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--fg);overflow:hidden}.stage{position:fixed;inset:0;display:grid;place-items:center;pointer-events:none}body.editing .stage{pointer-events:auto}svg{width:min(520px,86vw);height:auto;filter:drop-shadow(0 18px 40px rgba(0,0,0,.55))}.bottom{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);width:min(780px,92vw);pointer-events:auto}.bottom input{width:100%;padding:14px 16px;border-radius:14px;border:1px solid var(--ui-b);background:var(--ui);color:var(--fg);outline:none;font-size:16px}#shapeGroup{transition:transform 1800ms cubic-bezier(.2,.9,.2,1);transform-origin:0 0}svg path{transition:fill 600ms ease}.infoBtn{position:fixed;top:14px;right:14px;width:38px;height:38px;border-radius:12px;border:1px solid rgba(0,0,0,.18);background:#d9d9d9;color:#000;display:grid;place-items:center;cursor:pointer;pointer-events:auto;font-weight:800}.infoBtn:hover{background:#e6e6e6}.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;pointer-events:auto}.modal.open{display:flex}.card{width:min(860px,92vw);background:rgba(10,14,25,.95);border:1px solid var(--ui-b);border-radius:16px;padding:16px;box-shadow:0 18px 60px rgba(0,0,0,.6)}.card h3{margin:0 0 10px;font-size:16px}.card p{margin:8px 0;color:var(--muted);font-size:14px;line-height:1.45}.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}.box{border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.05);border-radius:12px;padding:10px}.box h4{margin:0 0 8px;font-size:14px;color:var(--fg)}.list{margin:0;padding-left:18px;color:var(--muted);font-size:14px;line-height:1.45}code{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);padding:2px 6px;border-radius:8px;color:var(--fg);font-size:13px}.actions{display:flex;justify-content:flex-end;margin-top:12px}.btn{border:1px solid var(--ui-b);background:var(--ui);color:var(--fg);border-radius:12px;padding:10px 12px;font-size:14px;cursor:pointer}.btn:hover{background:rgba(255,255,255,.12)}#editLayer{display:none}body.editing #editLayer{display:block}.handle{cursor:grab;pointer-events:auto}body.editing .handle:active{cursor:grabbing}.handleOutline{fill:rgba(0,0,0,.25)}.handleCore{fill:rgba(255,255,255,.95)}.handleRing{fill:none;stroke:rgba(255,255,255,.35);stroke-width:1.5}</style></head><body><button class="infoBtn" id="infoBtn" aria-label="Info">i</button><div class="stage"><svg id="svgRoot" viewBox="-220 -220 440 440" xmlns="http://www.w3.org/2000/svg"><g id="shapeGroup"></g><g id="editLayer"></g><g id="measureGroup" visibility="hidden"></g></svg></div><div class="bottom"><input id="cmd" placeholder="type shape name or command (random, edit, copy, export, rotate 90, red...)" autocomplete="off" spellcheck="false"/></div><div class="modal" id="modal" role="dialog" aria-modal="true"><div class="card"><h3>Info</h3><p>Type a shape name that exists in your <code>/shapes</code> folder. Press <b>Enter</b> to run commands. Clearing the input returns to blob mode.</p><div class="grid"><div class="box"><h4>Commands (press Enter)</h4><ul class="list"><li><code>random</code> — random existing shape (skips 404 + never repeats)</li><li><code>edit</code> — toggle edit mode (drag points)</li><li><code>copy</code> — copy current SVG</li><li><code>export</code> — download SVG</li><li><code>rotate 180</code> — rotate relative</li><li><code>red</code> / <code>#86c5e4</code> / <code>rgb(10,20,30)</code> — change color</li></ul><p style="margin:10px 0 0;color:var(--muted);font-size:13px">Command text stays in the input so you can hit Enter again.</p></div><div class="box"><h4>Shapes list (edit in code)</h4><p style="margin:0 0 8px;color:var(--muted);font-size:13px">This list is shown for convenience.</p><ul class="list" id="shapeList"></ul></div></div><div class="actions"><button class="btn" id="closeBtn">Close</button></div></div></div><script>(()=>{const TAU=Math.PI*2,lerp=(a,b,t)=>a+(b-a)*t,fmt=n=>Number(n).toFixed(3);const SHAPES=["circle","oval","triangle","square","rectangle","diamond","pentagon","hexagon","star","heart","lightning bolt","plus","cross","check","close","menu","search","home","user","play","pause","stop","download","upload","arrow up","arrow right","chevron","capsule","drop","trapezoid","parallelogram","settings","notification","netherlands"];const POINTS=520,BASE_R=140,TARGET_AREA=Math.PI*BASE_R*BASE_R*1.08,MORPH_MS_SHAPE=2800,ROTATE_MS=1800,BLOB_CTRL=22,EDIT_CTRL=24;const svgRoot=document.getElementById("svgRoot"),group=document.getElementById("shapeGroup"),editLayer=document.getElementById("editLayer"),measureGroup=document.getElementById("measureGroup"),cmd=document.getElementById("cmd"),infoBtn=document.getElementById("infoBtn"),modal=document.getElementById("modal"),closeBtn=document.getElementById("closeBtn"),shapeListEl=document.getElementById("shapeList");SHAPES.forEach(s=>{const li=document.createElement("li");li.textContent=s;shapeListEl.appendChild(li)});let fillColor="#ffffff",rotationDeg=0,currentShapeName="",mode="blob",renderStyle="smooth",raf=null,morphing=false,morphStart=0,morphDur=MORPH_MS_SHAPE,fromSets=null,toSets=null,currentSets=[makeCirclePoints(BASE_R)];function easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}function makeCirclePoints(r){const pts=[];for(let i=0;i<POINTS;i++){const th=i/POINTS*TAU;pts.push({x:r*Math.cos(th),y:r*Math.sin(th)})}return pts}function centroid(pts){let cx=0,cy=0;for(const p of pts){cx+=p.x;cy+=p.y}return{x:cx/pts.length,y:cy/pts.length}}function stabilizeCenter(sets){let cx=0,cy=0,count=0;for(const pts of sets)for(const p of pts){cx+=p.x;cy+=p.y;count++}cx/=count;cy/=count;for(const pts of sets)for(const p of pts){p.x-=cx;p.y-=cy}}function polygonArea(pts){let a=0;for(let i=0;i<pts.length;i++){const p=pts[i],q=pts[(i+1)%pts.length];a+=p.x*q.y-q.x*p.y}return a*.5}function totalAreaAbs(sets){let sum=0;for(const pts of sets)sum+=Math.abs(polygonArea(pts));return sum}function maxRadius(sets){let m=0;for(const pts of sets)for(const p of pts)m=Math.max(m,Math.hypot(p.x,p.y));return m}function scaleSets(sets,s){for(const pts of sets)for(const p of pts){p.x*=s;p.y*=s}}function normalizeSizeAndCenterByArea(sets){stabilizeCenter(sets);const a=totalAreaAbs(sets);const sArea=a>1e-6?Math.sqrt(TARGET_AREA/a):1;scaleSets(sets,sArea);const m=maxRadius(sets);if(m>BASE_R)scaleSets(sets,BASE_R/m*.985);stabilizeCenter(sets)}function toSmoothPath(pts){const n=pts.length,p=i=>pts[(i+n)%n];let d="";for(let i=0;i<n;i++){const p0=p(i-1),p1=p(i),p2=p(i+1),p3=p(i+2);const c1x=p1.x+(p2.x-p0.x)/6,c1y=p1.y+(p2.y-p0.y)/6,c2x=p2.x-(p3.x-p1.x)/6,c2y=p2.y-(p3.y-p1.y)/6;if(i===0)d+=`M ${fmt(p1.x)} ${fmt(p1.y)} `;d+=`C ${fmt(c1x)} ${fmt(c1y)}, ${fmt(c2x)} ${fmt(c2y)}, ${fmt(p2.x)} ${fmt(p2.y)} `}return d+"Z"}function toPolyPath(pts){let d=`M ${fmt(pts[0].x)} ${fmt(pts[0].y)} `;for(let i=1;i<pts.length;i++)d+=`L ${fmt(pts[i].x)} ${fmt(pts[i].y)} `;return d+"Z"}function ensurePathEls(n){while(group.children.length<n){const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("fill",fillColor);group.appendChild(p)}while(group.children.length>n)group.removeChild(group.lastChild);for(const el of group.children)el.setAttribute("fill",fillColor)}function setFill(c){fillColor=c;for(const el of group.children)el.setAttribute("fill",c)}function setRotation(deg){rotationDeg=deg;group.style.transitionDuration=ROTATE_MS+"ms";group.setAttribute("transform",`rotate(${rotationDeg})`)}function deepCopySets(sets){return sets.map(pts=>pts.map(p=>({x:p.x,y:p.y})))}function alignTargetToCurrent(cur,tgt){const n=cur.length,step=12;function score(shift,rev){let sum=0;for(let i=0;i<n;i+=step){const ti=rev?(((shift-i)%n+n)%n):((i+shift)%n);const dx=cur[i].x-tgt[ti].x,dy=cur[i].y-tgt[ti].y;sum+=dx*dx+dy*dy}return sum}const coarse=20;let bestShift=0,bestRev=false,bestScore=Infinity;for(let sh=0;sh<n;sh+=coarse)for(const rev of[false,true]){const sc=score(sh,rev);if(sc<bestScore){bestScore=sc;bestShift=sh;bestRev=rev}}for(let d=-coarse;d<=coarse;d++){const sh=(bestShift+d+n)%n;for(const rev of[false,true]){const sc=score(sh,rev);if(sc<bestScore){bestScore=sc;bestShift=sh;bestRev=rev}}}const out=new Array(n);for(let i=0;i<n;i++){const ti=bestRev?(((bestShift-i)%n+n)%n):((i+bestShift)%n);out[i]={x:tgt[ti].x,y:tgt[ti].y}}return out}const blobCtrl=Array.from({length:BLOB_CTRL},(_,i)=>({r:1,v:0,seed:(i+1)*999.123}));function rand01(x){const s=Math.sin(x)*43758.5453123;return s-Math.floor(s)}function updateBlob(dt,t){for(let i=0;i<BLOB_CTRL;i++){const c=blobCtrl[i];const target=1+.075*Math.sin(t*.5+i*.95)+.035*Math.sin(t*.22+i*1.65);const n=(rand01(c.seed+t*.32)-.5)*.14;const k=2.7,damp=2.1;const a=k*(target+n-c.r)-damp*c.v;c.v+=a*dt;c.r+=c.v*dt}}function catmullRomClosed(ctrlPts,samples){const n=ctrlPts.length,out=new Array(samples),get=i=>ctrlPts[(i%n+n)%n];for(let s=0;s<samples;s++){const tt=s/samples*n,i=Math.floor(tt),u=tt-i,p0=get(i-1),p1=get(i),p2=get(i+1),p3=get(i+2),u2=u*u,u3=u2*u;const x=.5*((2*p1.x)+(-p0.x+p2.x)*u+(2*p0.x-5*p1.x+4*p2.x-p3.x)*u2+(-p0.x+3*p1.x-3*p2.x+p3.x)*u3);const y=.5*((2*p1.y)+(-p0.y+p2.y)*u+(2*p0.y-5*p1.y+4*p2.y-p3.y)*u2+(-p0.y+3*p1.y-3*p2.y+p3.y)*u3);out[s]={x,y}}return out}function blobPointsFromCtrl(){const ctrlPts=new Array(BLOB_CTRL);for(let i=0;i<BLOB_CTRL;i++){const th=i/BLOB_CTRL*TAU,r=BASE_R*blobCtrl[i].r;ctrlPts[i]={x:r*Math.cos(th),y:r*Math.sin(th)}}const pts=catmullRomClosed(ctrlPts,POINTS);normalizeSizeAndCenterByArea([pts]);return pts}function clearMeasureGroup(){while(measureGroup.firstChild)measureGroup.removeChild(measureGroup.firstChild)}function parseViewBox(svgEl){const vb=svgEl.getAttribute("viewBox");if(!vb)return null;const parts=vb.trim().split(/[\s,]+/).map(Number);if(parts.length!==4||parts.some(x=>!Number.isFinite(x)))return null;return{minX:parts[0],minY:parts[1],w:parts[2],h:parts[3]}}function elementToPathData(el){const tag=el.tagName.toLowerCase();if(tag==="path")return el.getAttribute("d")||"";if(tag==="polygon"||tag==="polyline"){const pts=(el.getAttribute("points")||"").trim();if(!pts)return"";const nums=pts.split(/[\s,]+/).map(Number).filter(Number.isFinite);if(nums.length<4)return"";let d=`M ${nums[0]} ${nums[1]} `;for(let i=2;i<nums.length;i+=2)d+=`L ${nums[i]} ${nums[i+1]} `;if(tag==="polygon")d+="Z";return d}if(tag==="rect"){const x=Number(el.getAttribute("x")||0),y=Number(el.getAttribute("y")||0),w=Number(el.getAttribute("width")||0),h=Number(el.getAttribute("height")||0),rx=Number(el.getAttribute("rx")||0),ry=Number(el.getAttribute("ry")||0);if(!(w>0&&h>0))return"";if(rx>0||ry>0){const rrx=Math.min(rx||ry,w/2),rry=Math.min(ry||rx,h/2);return[`M ${x+rrx} ${y}`,`L ${x+w-rrx} ${y}`,`A ${rrx} ${rry} 0 0 1 ${x+w} ${y+rry}`,`L ${x+w} ${y+h-rry}`,`A ${rrx} ${rry} 0 0 1 ${x+w-rrx} ${y+h}`,`L ${x+rrx} ${y+h}`,`A ${rrx} ${rry} 0 0 1 ${x} ${y+h-rry}`,`L ${x} ${y+rry}`,`A ${rrx} ${rry} 0 0 1 ${x+rrx} ${y}`,`Z`].join(" ")}return`M ${x} ${y} L ${x+w} ${y} L ${x+w} ${y+h} L ${x} ${y+h} Z`}if(tag==="circle"){const cx=Number(el.getAttribute("cx")||0),cy=Number(el.getAttribute("cy")||0),r=Number(el.getAttribute("r")||0);if(!(r>0))return"";return`M ${cx-r} ${cy} A ${r} ${r} 0 1 0 ${cx+r} ${cy} A ${r} ${r} 0 1 0 ${cx-r} ${cy} Z`}if(tag==="ellipse"){const cx=Number(el.getAttribute("cx")||0),cy=Number(el.getAttribute("cy")||0),rx=Number(el.getAttribute("rx")||0),ry=Number(el.getAttribute("ry")||0);if(!(rx>0&&ry>0))return"";return`M ${cx-rx} ${cy} A ${rx} ${ry} 0 1 0 ${cx+rx} ${cy} A ${rx} ${ry} 0 1 0 ${cx-rx} ${cy} Z`}return""}function splitPathData(d){if(!d)return[];const m=d.match(/[Mm][^Mm]*/g);return m?m.map(s=>s.trim()).filter(Boolean):[d]}function samplePathElement(pathEl){const L=pathEl.getTotalLength();if(!isFinite(L)||L<=0)return null;const pts=[];for(let i=0;i<POINTS;i++){const p=pathEl.getPointAtLength(i/POINTS*L);pts.push({x:p.x,y:p.y})}return pts}const cache={},missing=new Set();async function loadShapeByName(name){const file=name.toLowerCase().trim().replace(/\s+/g,"-")+".svg";if(missing.has(file))return null;if(cache[file])return cache[file];try{const res=await fetch("shapes/"+file,{cache:"force-cache"});if(!res.ok){missing.add(file);return null}const txt=await res.text();const doc=new DOMParser().parseFromString(txt,"image/svg+xml");const svgEl=doc.querySelector("svg");if(!svgEl){missing.add(file);return null}const drawables=[...svgEl.querySelectorAll("path,polygon,polyline,rect,circle,ellipse")];if(!drawables.length){missing.add(file);return null}clearMeasureGroup();const wrap=document.createElementNS("http://www.w3.org/2000/svg","g");measureGroup.appendChild(wrap);const vb=parseViewBox(svgEl);if(vb)wrap.setAttribute("transform",`translate(${-vb.minX} ${-vb.minY})`);const sets=[];for(const el of drawables){const d0=elementToPathData(el);if(!d0)continue;if(el.tagName.toLowerCase()==="path"){const parts=splitPathData(d0);for(const part of parts){const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",part);const tr=el.getAttribute("transform");if(tr)p.setAttribute("transform",tr);wrap.appendChild(p);const pts=samplePathElement(p);if(pts)sets.push(pts)}}else{const p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",d0);const tr=el.getAttribute("transform");if(tr)p.setAttribute("transform",tr);wrap.appendChild(p);const pts=samplePathElement(p);if(pts)sets.push(pts)}}if(!sets.length){missing.add(file);return null}normalizeSizeAndCenterByArea(sets);cache[file]=sets;return sets}catch{missing.add(file);return null}}function render(){ensurePathEls(currentSets.length);for(let s=0;s<currentSets.length;s++){const pts=currentSets[s];const d=renderStyle==="poly"?toPolyPath(pts):toSmoothPath(pts);group.children[s].setAttribute("d",d)}if(isEditing)updateEditHandles()}function spawnFromTargets(targetSetsIn){const spawned=targetSetsIn.map(tset=>{const base=mode==="blob"?blobPointsFromCtrl():makeCirclePoints(BASE_R);const b=base.map(p=>({x:p.x,y:p.y}));const ct=centroid(tset),cb=centroid(b);for(const p of b){p.x=(p.x-cb.x)+ct.x;p.y=(p.y-cb.y)+ct.y}return b});normalizeSizeAndCenterByArea(spawned);return spawned}function beginMorph(nextSets,durationMs){if(currentSets.length!==nextSets.length)currentSets=spawnFromTargets(nextSets);const aligned=nextSets.map((pts,idx)=>{const cur=currentSets[idx];const t=pts.map(p=>({x:p.x,y:p.y}));return alignTargetToCurrent(cur,t)});normalizeSizeAndCenterByArea(currentSets);normalizeSizeAndCenterByArea(aligned);fromSets=deepCopySets(currentSets);toSets=deepCopySets(aligned);morphStart=performance.now();morphDur=durationMs;morphing=true;start()}let lastNow=performance.now();function tick(now){const dt=Math.min(.033,(now-lastNow)/1000);lastNow=now;const t=now/1000;if(mode==="blob"&&!morphing){updateBlob(dt,t);currentSets=[blobPointsFromCtrl()];renderStyle="smooth";render();raf=requestAnimationFrame(tick);return}if(morphing){const tt=Math.min(1,(now-morphStart)/morphDur),e=easeInOutCubic(tt);const interp=fromSets.map((a,si)=>{const b=toSets[si],out=new Array(POINTS);for(let i=0;i<POINTS;i++)out[i]={x:lerp(a[i].x,b[i].x,e),y:lerp(a[i].y,b[i].y,e)};return out});normalizeSizeAndCenterByArea(interp);currentSets=interp;if(tt>=1){morphing=false;currentSets=deepCopySets(toSets);render();if(mode==="shape"&&!isEditing){raf=null;return}}}render();raf=requestAnimationFrame(tick)}function start(){if(raf)cancelAnimationFrame(raf);raf=requestAnimationFrame(tick)}function isCssColor(str){const s=str.trim();if(!s)return false;const test=document.createElement("div");test.style.color="";test.style.color=s;return!!test.style.color}function exportSVGString(){const vb="-220 -220 440 440";const ds=[...group.children].map(p=>p.getAttribute("d")||"").filter(Boolean);const paths=ds.map(d=>`    <path d="${d}" fill="${fillColor}"/>`).join("\n");return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${vb}">\n  <g transform="rotate(${rotationDeg})">\n${paths}\n  </g>\n</svg>\n`}function doCopy(){navigator.clipboard.writeText(exportSVGString())}function doExport(){const text=exportSVGString();const blob=new Blob([text],{type:"image/svg+xml;charset=utf-8"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="shape.svg";document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url)}async function applyShape(name){const v=name.trim();if(!v){exitEditMode();mode="blob";currentShapeName="";morphing=false;renderStyle="smooth";start();return}const sets=await loadShapeByName(v);if(!sets)return;exitEditMode();mode="shape";currentShapeName=v.toLowerCase();renderStyle="poly";beginMorph(sets,MORPH_MS_SHAPE)}function chooseRandomOrder(){const arr=SHAPES.slice();for(let i=arr.length-1;i>0;i--){const j=(Math.random()*(i+1))|0;[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}async function randomExistingShape(){const cur=currentShapeName;const order=chooseRandomOrder();for(const name of order){const low=name.toLowerCase();if(low===cur)continue;const sets=await loadShapeByName(name);if(!sets)continue;exitEditMode();mode="shape";currentShapeName=low;renderStyle="poly";beginMorph(sets,MORPH_MS_SHAPE);return true}return false}cmd.addEventListener("keydown",async e=>{if(e.key!=="Enter")return;const raw=cmd.value.trim();if(!raw){await applyShape("");return}const lower=raw.toLowerCase();if(lower==="copy"){doCopy();return}if(lower==="export"){doExport();return}if(lower==="random"){await randomExistingShape();return}if(lower==="edit"){toggleEditMode();return}if(lower.startsWith("rotate ")){const n=parseFloat(raw.slice(7).trim());if(Number.isFinite(n))setRotation(rotationDeg+n);return}if(isCssColor(raw)){setFill(raw);return}await applyShape(raw)});cmd.addEventListener("input",async()=>{if(cmd.value.trim()==="")await applyShape("")});infoBtn.addEventListener("click",()=>modal.classList.add("open"));closeBtn.addEventListener("click",()=>modal.classList.remove("open"));modal.addEventListener("click",e=>{if(e.target===modal)modal.classList.remove("open")});window.addEventListener("keydown",e=>{if(e.key==="Escape")modal.classList.remove("open")});let isEditing=false,editCtrlPts=null,draggingIndex=-1;function svgPointFromClient(clientX,clientY){const pt=svgRoot.createSVGPoint();pt.x=clientX;pt.y=clientY;const ctm=svgRoot.getScreenCTM();if(!ctm)return{x:0,y:0};const inv=ctm.inverse();const p=pt.matrixTransform(inv);return{x:p.x,y:p.y}}function getSingleSetForEdit(){return currentSets[0].map(p=>({x:p.x,y:p.y}))}function initEditFromCurrent(){const pts=getSingleSetForEdit();editCtrlPts=[];for(let i=0;i<EDIT_CTRL;i++){const idx=Math.floor(i/EDIT_CTRL*pts.length);editCtrlPts.push({x:pts[idx].x,y:pts[idx].y})}normalizeSizeAndCenterByArea([editCtrlPts])}function rebuildFromEditCtrl(){const dense=catmullRomClosed(editCtrlPts,POINTS);normalizeSizeAndCenterByArea([dense]);currentSets=[dense];mode="shape";renderStyle="smooth";currentShapeName="custom";morphing=false;start()}function clearEditLayer(){while(editLayer.firstChild)editLayer.removeChild(editLayer.firstChild)}function buildEditHandles(){clearEditLayer();for(let i=0;i<EDIT_CTRL;i++){const g=document.createElementNS("http://www.w3.org/2000/svg","g");g.setAttribute("class","handle");g.dataset.index=String(i);const o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("r","8.5");o.setAttribute("class","handleOutline");g.appendChild(o);const c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("r","6");c.setAttribute("class","handleCore");g.appendChild(c);const r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("r","10.5");r.setAttribute("class","handleRing");g.appendChild(r);editLayer.appendChild(g)}updateEditHandles()}function updateEditHandles(){if(!isEditing||!editCtrlPts)return;const nodes=[...editLayer.children];for(let i=0;i<nodes.length;i++){const p=editCtrlPts[i];nodes[i].setAttribute("transform",`translate(${fmt(p.x)} ${fmt(p.y)})`)}}function onPointerDown(e){const target=e.target.closest?.(".handle");if(!target)return;draggingIndex=Number(target.dataset.index);target.setPointerCapture?.(e.pointerId);e.preventDefault()}function onPointerMove(e){if(!isEditing||draggingIndex<0)return;const p=svgPointFromClient(e.clientX,e.clientY);editCtrlPts[draggingIndex].x=p.x;editCtrlPts[draggingIndex].y=p.y;rebuildFromEditCtrl();e.preventDefault()}function onPointerUp(){draggingIndex=-1}function enterEditMode(){if(isEditing)return;isEditing=true;document.body.classList.add("editing");if(mode==="blob"){currentSets=[blobPointsFromCtrl()];mode="shape";renderStyle="smooth";currentShapeName="custom";morphing=false}initEditFromCurrent();buildEditHandles();svgRoot.addEventListener("pointerdown",onPointerDown);window.addEventListener("pointermove",onPointerMove,{passive:false});window.addEventListener("pointerup",onPointerUp);start()}function exitEditMode(){if(!isEditing)return;isEditing=false;document.body.classList.remove("editing");draggingIndex=-1;svgRoot.removeEventListener("pointerdown",onPointerDown);window.removeEventListener("pointermove",onPointerMove);window.removeEventListener("pointerup",onPointerUp);clearEditLayer();if(mode==="shape"&&!morphing){if(raf)cancelAnimationFrame(raf);raf=null}}function toggleEditMode(){isEditing?exitEditMode():enterEditMode()}setFill("#ffffff");setRotation(0);mode="blob";renderStyle="smooth";currentShapeName="";start()})();</script></body></html>
